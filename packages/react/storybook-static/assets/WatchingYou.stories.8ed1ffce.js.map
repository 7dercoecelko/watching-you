{"version":3,"file":"WatchingYou.stories.8ed1ffce.js","sources":["../../../core/src/util/getDomTranslateProp.ts","../../../core/src/util/log.ts","../../../core/src/util/math.ts","../../../core/src/util/target.ts","../../../core/src/util/type.ts","../../../core/src/index.ts","../../src/util.ts","../../src/index.ts"],"sourcesContent":["// the `domTransform` format we get from our test environment is different from the browser's format, which is a compatibility writing method\nconst splitRegex = /px\\) rotate\\(|translate\\(|deg\\)|px,/;\nfunction getDomTranslateProp(dom: Element) {\n  const domTransform = getComputedStyle(dom).transform;\n  if (domTransform === 'none') return { x: 0, y: 0 };\n  if (domTransform.includes('translate')) {\n    const result = domTransform.split(splitRegex);\n    return { x: Number(result[1]), y: Number(result[2]) };\n  }\n  // the way faster then `new DOMMatrix` or `regex`\n  const result = domTransform\n    .slice(0, -1)\n    .split(', ')\n    .slice(-2)\n    .map(Number);\n  return { x: result[0], y: result[1] };\n}\n\nexport default getDomTranslateProp;\n","type logLevel = 'error' | 'warn' | 'verbose';\n\nfunction log(message: string, level: logLevel) {\n  if (level === 'error') {\n    throw Error(message);\n  }\n  if (process.env.NODE_ENV === 'production') return;\n  if (level === 'warn') {\n    console.warn(message);\n    return;\n  }\n  if (level === 'verbose') {\n    console.log(message);\n    return;\n  }\n}\n\nexport default log;\n","function round(number: number) {\n  return Math.round(number * 10) / 10;\n}\n\nexport { round };\n","import {\n  WatchingYouTargetDom,\n  WatchingYouTargetInput,\n  WatchingYouTargetMouse,\n} from '../type/Target';\n\nfunction isTargetMouse(targetProps?: {\n  target?: unknown;\n  targetType?: unknown;\n}): targetProps is WatchingYouTargetMouse {\n  return (\n    !targetProps ||\n    targetProps.targetType === 'mouse' ||\n    (!targetProps.targetType && !targetProps.target)\n  );\n}\nfunction isTargetDom(targetProps?: {\n  target?: unknown;\n  targetType?: unknown;\n}): targetProps is WatchingYouTargetDom {\n  if (!targetProps) return false;\n  return (\n    targetProps.targetType === 'dom' ||\n    (!targetProps.targetType && !!targetProps.target)\n  );\n}\nfunction isTargetInput(targetProps?: {\n  target?: unknown;\n  targetType?: unknown;\n}): targetProps is WatchingYouTargetInput {\n  if (!targetProps) return false;\n  // if(!watch) log(`If the targetType parameter is input, then the watch must be a input`,'warn');\n  return targetProps.targetType === 'input';\n}\n\nexport { isTargetMouse, isTargetDom, isTargetInput };\n","function isHtmlElement(x: unknown): x is HTMLElement {\n  return x instanceof HTMLElement;\n}\nexport { isHtmlElement };\n","import { Coordinate } from './type/Coordinate';\nimport getDomTranslateProp from './util/getDomTranslateProp';\nimport log from './util/log';\nimport { round } from './util/math';\nimport {\n  isTargetDom,\n  isTargetInput,\n  isTargetMouse,\n} from './util/target';\nimport { isHtmlElement } from './util/type';\n\ninterface WatchingYouRenderTransform {\n  translate: {\n    x: number;\n    y: number;\n  };\n  rotate: number;\n}\ntype WatchingYouRender = (\n  transform: WatchingYouRenderTransform,\n) => void;\ntype WatchingYouWatcher = string | Element;\ntype WatchingYouTarget = string | Element;\ntype WatchingYouTargetType = 'mouse' | 'dom' | 'input';\ntype WatchingYouPower = number | { x?: number; y?: number };\ninterface WatchingYouOptions {\n  target?: WatchingYouTarget;\n  targetType?: WatchingYouTargetType;\n  power?: WatchingYouPower;\n  render?: WatchingYouRender;\n  rotatable?: boolean;\n  movable?: boolean;\n}\nconst DEFAULT_POWER = 50;\nconst DEFAULT_OBSERVED_TYPE = 'mouse';\nconst ORIGIN_TRANSFORM = {\n  translate: { x: 0, y: 0 },\n  rotate: 0,\n};\n\nclass WatchingYou {\n  static #mousePosition: Coordinate | null = null;\n  static #mouseObserverCount: number = 0;\n  static #updateWatchPositionViaMouse = (e: MouseEvent): void => {\n    WatchingYou.#mousePosition = {\n      x: round(e.clientX),\n      y: round(e.clientY),\n    };\n  };\n\n  #customRender: WatchingYouRender | null = null;\n  #watcherDom: HTMLElement | null = null;\n  #targetDom: HTMLElement | null = null;\n  #watcherPosition: Coordinate | null = null;\n  #_targetPosition: Coordinate | null = null;\n  #lastRenderingWatcherPosition: Coordinate | null = null;\n  #lastRenderingTargetPosition: Coordinate | null = null;\n  #rotatable: boolean = true;\n  #movable: boolean = true;\n  #targetType: WatchingYouTargetType = DEFAULT_OBSERVED_TYPE;\n  #powerX = DEFAULT_POWER;\n  #powerY = DEFAULT_POWER;\n  #fakeInputDom: HTMLElement | null = null;\n  #rafId: number | null = null;\n\n  get #targetPosition() {\n    if (this.#targetType === 'mouse')\n      return WatchingYou.#mousePosition;\n    return this.#_targetPosition;\n  }\n  set #targetPosition(newPosition) {\n    if (this.#targetType === 'mouse')\n      WatchingYou.#mousePosition = newPosition;\n    this.#_targetPosition = newPosition;\n  }\n\n  constructor(\n    watcherOrOptions?: WatchingYouWatcher | WatchingYouOptions,\n    optionsBase: WatchingYouOptions = {},\n  ) {\n    const isFirstParamOptions =\n      typeof watcherOrOptions === 'object' &&\n      !isHtmlElement(watcherOrOptions);\n    const options = isFirstParamOptions\n      ? (watcherOrOptions as WatchingYouOptions)\n      : optionsBase;\n    const watcher = isFirstParamOptions\n      ? undefined\n      : (watcherOrOptions as WatchingYouWatcher);\n    // TODO: Don't trust the parameters given by the user\n    const { power, rotatable, movable, render, ...targetProps } =\n      options;\n    this.setCustomRender(render);\n    this.setWatcher(watcher);\n    this.setTarget(targetProps);\n    this.setPower(power);\n    this.setRotatable(rotatable);\n    this.setMovable(movable);\n  }\n\n  #updateWatcherPosition = (): void => {\n    if (this.#watcherDom === null) return;\n    const rect = this.#watcherDom.getBoundingClientRect();\n    const translate = getDomTranslateProp(this.#watcherDom);\n    const x = round(rect.left - translate.x + rect.width / 2);\n    const y = round(rect.top - translate.y + rect.height / 2);\n    this.#watcherPosition = { x, y };\n  };\n\n  #updateWatchPositionViaDom = (): void => {\n    if (!this.#targetDom) return;\n    const rect = this.#targetDom.getBoundingClientRect();\n    // XXX: Only return the center position of the dom now\n    const x = round(rect.left + rect.width / 2);\n    const y = round(rect.top + rect.height / 2);\n    this.#targetPosition = { x, y };\n  };\n\n  #updateWatchPositionViaInput = (): void => {\n    if (!this.#targetDom) return;\n    if (!this.#fakeInputDom) {\n      this.#createFakeInput();\n    }\n    const fakeInputDom = this.#fakeInputDom!;\n    const thisWatchDom = this.#targetDom as HTMLInputElement;\n\n    if (fakeInputDom.innerText !== thisWatchDom.value) {\n      fakeInputDom.innerText = thisWatchDom.value;\n    }\n    if (thisWatchDom.value === '') {\n      this.#targetPosition = null;\n      return;\n    }\n\n    const { font, letterSpacing, width, lineHeight, paddingLeft } =\n      getComputedStyle(this.#targetDom);\n    const paddingLeftNumber = Number(paddingLeft.slice(0, -2));\n    const targetTagName = this.#targetDom.tagName;\n    const isInput = targetTagName === 'INPUT';\n    const isTextarea = targetTagName === 'TEXTAREA';\n    const inputRect = this.#targetDom.getBoundingClientRect();\n    const fakeInputRect = fakeInputDom.getBoundingClientRect();\n    if (isInput) {\n      fakeInputDom.setAttribute(\n        'style',\n        `\n          position: absolute;\n          opacity: 0;\n          top: 0;\n          left: -100%;\n          pointer-events: none;\n          display: inline-block;\n          line-height: ${lineHeight};\n          font: ${font};\n          max-width: ${width};\n          letter-spacing: ${letterSpacing};\n          `,\n      );\n      const x = round(\n        inputRect.left + fakeInputRect.width + paddingLeftNumber,\n      );\n      const y = round(inputRect.top + fakeInputRect.height / 2);\n      this.#targetPosition = { x, y };\n    }\n    if (isTextarea) {\n      fakeInputDom.setAttribute(\n        'style',\n        `\n          position: absolute;\n          opacity: 0;\n          top: 0;\n          left: -100%;\n          pointer-events: none;\n          display: inline-block;\n          word-break: keep-all;\n          line-height: ${lineHeight};\n          font: ${font};\n          letter-spacing: ${letterSpacing};\n        `,\n      );\n      const widthNumber = Number(width.slice(0, -2));\n      const fakeWidth = fakeInputRect.width % widthNumber;\n      const x = round(inputRect.left + fakeWidth + paddingLeftNumber);\n      const y = round(inputRect.top + inputRect.height / 2);\n      this.#targetPosition = { x, y };\n    }\n  };\n\n  #createFakeInput = (): void => {\n    if (!this.#targetDom) return;\n    this.#fakeInputDom = document.createElement('div');\n    document.querySelector('body')?.append(this.#fakeInputDom); //XXX: Maybe we should let the users decide?\n  };\n\n  #checkWatcherDomVisibility = (): boolean => {\n    if (!this.#watcherDom) return false;\n    const rect = this.#watcherDom.getBoundingClientRect();\n    // not exact, but very efficient\n    const boundaryY = this.#powerY * 2;\n    const boundaryX = this.#powerX * 2;\n    const top = rect.top - boundaryY;\n\n    // early return, saving efficiency\n    if (\n      top >\n      (window.innerHeight || document.documentElement.clientHeight)\n    )\n      return false;\n    const bottom = rect.bottom + boundaryY;\n    if (bottom < 0) return false;\n    const left = rect.left - boundaryX;\n    if (\n      left >\n      (window.innerWidth || document.documentElement.clientWidth)\n    )\n      return false;\n    const right = rect.right + boundaryX;\n    if (right < 0) return false;\n    return true;\n  };\n\n  #calculateTransform = (): Parameters<WatchingYouRender>[0] => {\n    const result: Parameters<WatchingYouRender>[0] = {\n      translate: { x: 0, y: 0 },\n      rotate: 0,\n    };\n    if (!this.#watcherPosition) return result;\n    if (!this.#targetPosition) return result;\n    if (!this.#movable && !this.#rotatable) return result;\n    const deltaX = this.#targetPosition.x - this.#watcherPosition.x;\n    const deltaY = this.#targetPosition.y - this.#watcherPosition.y;\n    const symbolX = deltaX >= 0 ? 1 : -1;\n    const symbolY = deltaY >= 0 ? 1 : -1;\n    if (this.#movable) {\n      const distanceX = Math.abs(deltaX);\n      const distanceY = Math.abs(deltaY);\n      const radians = Math.atan2(distanceY, distanceX);\n      const translateX =\n        Math.min(distanceX, Math.cos(radians) * this.#powerX) *\n        symbolX;\n      const translateY =\n        Math.min(distanceY, Math.sin(radians) * this.#powerY) *\n        symbolY;\n      result.translate.x = round(translateX);\n      result.translate.y = round(translateY);\n    }\n    if (this.#rotatable) {\n      const degrees = (Math.atan2(deltaY, deltaX) * 180) / Math.PI;\n      result.rotate = round(degrees + 90);\n    }\n    return result;\n  };\n\n  #defaultRender: WatchingYouRender = (transform) => {\n    if (!this.#watcherDom) return;\n    this.#watcherDom.style.transform = `translate(${transform.translate.x}px,${transform.translate.y}px) rotate(${transform.rotate}deg)`;\n  };\n\n  #needRender = (): boolean => {\n    if (\n      this.#lastRenderingWatcherPosition?.x !==\n      this.#watcherPosition?.x\n    )\n      return true;\n    if (\n      this.#lastRenderingWatcherPosition?.y !==\n      this.#watcherPosition?.y\n    )\n      return true;\n    if (\n      this.#lastRenderingTargetPosition?.x !== this.#targetPosition?.x\n    )\n      return true;\n    if (\n      this.#lastRenderingTargetPosition?.y !== this.#targetPosition?.y\n    )\n      return true;\n    return false;\n  };\n\n  #render = (): void => {\n    const transform = this.#calculateTransform();\n    if (this.#customRender) {\n      this.#customRender(transform);\n    } else {\n      this.#defaultRender(transform);\n    }\n    this.#lastRenderingWatcherPosition = this.#watcherPosition;\n    this.#lastRenderingTargetPosition = this.#targetPosition;\n  };\n\n  setWatcher = (watcher?: WatchingYouWatcher): void => {\n    if (watcher === undefined) return;\n    if (isHtmlElement(watcher)) {\n      this.#watcherDom = watcher;\n    } else if (typeof watcher === 'string') {\n      this.#watcherDom = document.querySelector(watcher);\n    } else {\n      log(`Unexpected watcher: ${JSON.stringify(watcher)}`, 'warn');\n    }\n  };\n\n  setRotatable = (rotatable: boolean = true): void => {\n    this.#rotatable = !!rotatable;\n  };\n\n  setMovable = (movable: boolean = true): void => {\n    this.#movable = !!movable;\n  };\n\n  setTarget = (targetProps?: {\n    target?: WatchingYouTarget;\n    targetType?: WatchingYouTargetType;\n  }): void => {\n    if (this.#targetType === 'mouse' && this.#rafId !== null) {\n      WatchingYou.#mouseObserverCount--;\n    }\n    if (isTargetMouse(targetProps)) {\n      this.#targetType = 'mouse';\n      this.#targetDom = null;\n    } else if (isTargetDom(targetProps)) {\n      const { target } = targetProps;\n      this.#targetType = 'dom';\n      this.#targetDom = isHtmlElement(target)\n        ? target\n        : document.querySelector(target);\n    } else if (isTargetInput(targetProps)) {\n      const { target } = targetProps;\n      this.#targetType = 'input';\n      this.#targetDom = isHtmlElement(target)\n        ? target\n        : document.querySelector(target);\n    } else {\n      log(\n        `Unexpected target: ${JSON.stringify(targetProps)}`,\n        'warn',\n      );\n    }\n    if (this.#targetType === 'mouse' && this.#rafId !== null) {\n      WatchingYou.#mouseObserverCount++;\n    }\n  };\n\n  setCustomRender = (render?: WatchingYouRender): void => {\n    if (render !== undefined) {\n      this.#customRender = render;\n    }\n  };\n\n  setPower = (power?: WatchingYouPower) => {\n    if (power !== undefined) {\n      if (typeof power === 'number') {\n        this.#powerX = power;\n        this.#powerY = power;\n        return;\n      }\n      if (power?.x !== undefined) this.#powerX = power.x;\n      if (power?.y !== undefined) this.#powerY = power.y;\n    }\n  };\n\n  start = (): void => {\n    if (this.#rafId !== null) return;\n    if (this.#targetType === 'mouse') {\n      if (WatchingYou.#mouseObserverCount === 0) {\n        window.addEventListener(\n          'mousemove',\n          WatchingYou.#updateWatchPositionViaMouse,\n        );\n      }\n      WatchingYou.#mouseObserverCount++;\n    }\n    const nextRaf = () => {\n      if (this.#checkWatcherDomVisibility()) {\n        this.#updateWatcherPosition();\n        if (this.#targetType === 'dom') {\n          this.#updateWatchPositionViaDom();\n        }\n        if (this.#targetType === 'input') {\n          this.#updateWatchPositionViaInput();\n        }\n        if (this.#needRender()) {\n          this.#render();\n        }\n      }\n      this.#rafId = requestAnimationFrame(nextRaf);\n    };\n    nextRaf();\n  };\n\n  stop = (): void => {\n    if (this.#rafId === null) return;\n    if (this.#targetType === 'mouse') {\n      WatchingYou.#mouseObserverCount--;\n    }\n    if (WatchingYou.#mouseObserverCount === 0) {\n      window.removeEventListener(\n        'mousemove',\n        WatchingYou.#updateWatchPositionViaMouse,\n      );\n    }\n\n    cancelAnimationFrame(this.#rafId || 0);\n    this.#rafId = null;\n    if (this.#watcherDom) {\n      if (this.#customRender) {\n        this.#customRender(ORIGIN_TRANSFORM);\n      } else {\n        this.#defaultRender(ORIGIN_TRANSFORM);\n      }\n    }\n    if (this.#fakeInputDom) {\n      this.#fakeInputDom.remove();\n      this.#fakeInputDom = null;\n    }\n  };\n}\n\nexport default WatchingYou;\nexport type {\n  WatchingYouRenderTransform,\n  WatchingYouRender,\n  WatchingYouWatcher,\n  WatchingYouTarget,\n  WatchingYouTargetType,\n  WatchingYouPower,\n  Coordinate as WatchingYouCoordinate,\n  WatchingYouOptions,\n};\n","function concatObject(...a: unknown[]) {\n  return Object.assign({}, ...a);\n}\n\nexport { concatObject };\n","import React, { useRef, useState, useEffect, useMemo } from 'react';\nimport WatchingYouBase, {\n  WatchingYouRenderTransform,\n  WatchingYouOptions,\n} from '../../core/src/index';\nimport { concatObject } from './util';\n\ninterface WatchingYouReactHookProps\n  extends Omit<WatchingYouOptions, 'render'> {\n  active?: boolean;\n}\ninterface WatchingYouReactHocProps extends WatchingYouReactHookProps {\n  children: React.ReactNode;\n}\n\nconst useWatchingYou = (props: WatchingYouReactHookProps = {}) => {\n  const {\n    target,\n    targetType,\n    power,\n    rotatable,\n    movable,\n    active = true,\n  } = props;\n  const watcherRef = useRef(null);\n  const [transform, setTransform] =\n    useState<WatchingYouRenderTransform>({\n      translate: { x: 0, y: 0 },\n      rotate: 0,\n    });\n  const watchingYouRef = useRef(\n    new WatchingYouBase({\n      ...props,\n      render: (newTransform) => {\n        setTransform(newTransform);\n      },\n    }),\n  );\n  useEffect(() => {\n    watchingYouRef.current.setTarget({\n      target,\n      targetType,\n    });\n  }, [target, targetType]);\n  useEffect(() => {\n    watchingYouRef.current.setPower(power);\n  }, [power]);\n  useEffect(() => {\n    watchingYouRef.current.setRotatable(rotatable);\n  }, [rotatable]);\n  useEffect(() => {\n    watchingYouRef.current.setMovable(movable);\n  }, [movable]);\n  useEffect(() => {\n    watchingYouRef.current.setWatcher(\n      watcherRef.current || undefined,\n    );\n  }, [watchingYouRef]);\n  useEffect(() => {\n    if (active) {\n      watchingYouRef.current.start();\n      return watchingYouRef.current.stop;\n    } else {\n      watchingYouRef.current.stop();\n      return;\n    }\n  }, [active]);\n  useEffect(() => {\n    watchingYouRef.current.start();\n    return watchingYouRef.current.stop;\n  }, []);\n  const watchingYouWatcherProps = useMemo(() => {\n    return {\n      ref: watcherRef,\n      style: {\n        transform: `translate(${transform.translate.x}px,${transform.translate.y}px) rotate(${transform.rotate}deg)`,\n      },\n    };\n  }, [\n    transform.translate.x,\n    transform.translate.y,\n    transform.rotate,\n  ]);\n  return [watchingYouWatcherProps, watchingYouRef.current] as const;\n};\nconst WatchingYou: React.FC<WatchingYouReactHocProps> = (props) => {\n  const { children, ...watchingYouProps } = props;\n  const [watchingYouWatcherProps] = useWatchingYou(watchingYouProps);\n  if (!React.isValidElement(children)) return null;\n  return React.cloneElement(\n    children,\n    concatObject(children.props, {\n      ref: watchingYouWatcherProps.ref,\n      style: concatObject(\n        children?.props?.style,\n        watchingYouWatcherProps.style,\n      ),\n    }),\n  );\n};\n\nexport default React.memo(WatchingYou);\nexport { useWatchingYou };\n"],"names":["splitRegex","getDomTranslateProp","dom","domTransform","result","log","message","level","round","number","isTargetMouse","targetProps","isTargetDom","isTargetInput","isHtmlElement","x","DEFAULT_POWER","DEFAULT_OBSERVED_TYPE","ORIGIN_TRANSFORM","WatchingYou","watcherOrOptions","optionsBase","__privateAdd","_targetPosition","_customRender","_watcherDom","_targetDom","_watcherPosition","__targetPosition","_lastRenderingWatcherPosition","_lastRenderingTargetPosition","_rotatable","_movable","_targetType","_powerX","_powerY","_fakeInputDom","_rafId","_updateWatcherPosition","__privateGet","rect","translate","y","__privateSet","_updateWatchPositionViaDom","targetPosition_set","_updateWatchPositionViaInput","_createFakeInput","fakeInputDom","thisWatchDom","font","letterSpacing","width","lineHeight","paddingLeft","paddingLeftNumber","targetTagName","isInput","isTextarea","inputRect","fakeInputRect","widthNumber","fakeWidth","_a","_checkWatcherDomVisibility","boundaryY","boundaryX","_calculateTransform","targetPosition_get","deltaX","deltaY","symbolX","symbolY","distanceX","distanceY","radians","translateX","translateY","degrees","_defaultRender","transform","_needRender","_b","_c","_d","_e","_f","_g","_h","_render","__publicField","watcher","rotatable","movable","_mouseObserverCount","target","render","power","_updateWatchPositionViaMouse","nextRaf","isFirstParamOptions","options","_WatchingYou$2","_mousePosition","newPosition","e","concatObject","a","useWatchingYou","props","targetType","active","watcherRef","useRef","setTransform","useState","watchingYouRef","WatchingYouBase","newTransform","useEffect","useMemo","children","watchingYouProps","watchingYouWatcherProps","React","WatchingYou$1"],"mappings":"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"}